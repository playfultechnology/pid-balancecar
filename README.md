# pid-balancecar
Code, usage notes for operation of an STM32-controlled "self-balancing car", as shown below:

<img src="images/balancecar.jpg"/>

There are several similar models available from different suppliers on AliExpress, BangGood etc.

## Source Code
The "open source" code was supplied by the vendor as a baidu link. 
Link: https://pan.baidu.com/s/1M-D3hrumQRwJgep1K78iIw   
Password: bx5w
The problem is you can't download from baidu without a baidu account, and you can't create a baidu account without supplying a Chinese phone number. So, the workaround is....

Step #1: Go to https://oneleaf.icu/ and enter link and extraction code above

Step #2: Before following the generated download link, you need to edit the "user-agent" property of your browser. In Firefox, go to about:config
Create a new "string" called general.useragent.override with the value "oneleaf"

Now, paste the download link generated by oneleaf and you should be able to download the file via the browser.


## Operation
- Long press on USER button: toggle operation mode
  - "putong" (普通) = "ordinary" (i.e. static balance)
  - "bizhang" (蔽障) = "obstacle" (i.e. moves to avoid obstacles placed in front of ultrasonic sensor)
 - Short press on USER button: start/stop balancing
 
## Hardware
- 2x [MG513P3012V](https://www.aliexpress.com/item/4000996252848.html) Motors, 30:1 gear ratio
<img src="images/motor_spec.jpg"/>

## Adding the CCD Line-Following Module
- Compile the Keil uVision project with CCD support contained in pid-balancecar\download\CCD Attachment\TSL1401线性CCD模块附送资料V3.1-202120217\2.平衡小车专用CCD巡线代码\2.STM32平衡小车 CCD巡线\CCD巡线代码【高配版平衡小车STM32F405RGT6】
- If required, install support for the STM32F405RGT6 board
- To upload the code (without using the STLink dongle), load the FlyMCU application.
- Set the COM port and bps:76800, then hit the big (P) button to program the board.
